<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>æ•‘ä¸–è€…ä¹‹æ¨¹ m - é‡ç‹è¨ˆæ™‚å™¨</title>
<style>
  :root{
    --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb;
    --brand:#22d3ee; --accent:#a78bfa; --ok:#34d399; --warn:#f59e0b; --danger:#ef4444;
    --card:#0b1220; --ring:rgba(34,211,238,.4); --shadow:0 10px 30px rgba(0,0,0,.35);
    font-synthesis-weight:none;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background: radial-gradient(1200px 600px at 20% -10%, rgba(167,139,250,.14), transparent 60%),
                radial-gradient(900px 500px at 110% 20%, rgba(34,211,238,.12), transparent 60%),
                var(--bg);
    color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Microsoft JhengHei", "Noto Sans TC", Arial, "PingFang TC", sans-serif;
    -webkit-tap-highlight-color: transparent;
  }
  .wrap{max-width:1200px; margin:28px auto; padding:0 20px;}
  header{
    position:sticky; top:0; z-index:10;
    display:flex; align-items:center; justify-content:space-between; gap:16px;
    margin-bottom:14px; padding:12px 0;
    background:linear-gradient(180deg, rgba(15,23,42,.85), rgba(15,23,42,0));
    backdrop-filter:saturate(120%) blur(2px);
  }
  h1{font-size:clamp(18px,2.6vw,28px); margin:0; letter-spacing:.5px}
  .now{font-variant-numeric:tabular-nums; color:var(--muted); font-size:13px}

  .grid{display:grid; gap:18px; grid-template-columns: 380px 1fr;}
  .panel{
    background:linear-gradient(180deg, rgba(255,255,255,.02), transparent 40%), var(--panel);
    border:1px solid rgba(255,255,255,.06);
    border-radius:18px; padding:18px; box-shadow:var(--shadow);
  }

  /* å·¦å´ */
  .meta{display:grid; gap:14px}
  .kv{display:grid; gap:8px}
  .kv label{font-size:13px; color:var(--muted)}

  .row{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
  /* æ–°çš„ä¸‰æ¬„ï¼šA / B / åˆ†æµ+è‰²å¡Š */
  .row3{grid-template-columns: 1fr 1fr auto;}
  .laneWrap{display:flex; align-items:center; gap:8px;}
  .laneWrap .input{width:76px; text-align:center}
  .swatch{
    width:28px; height:28px; border-radius:8px; border:1px solid rgba(255,255,255,.2);
    box-shadow: inset 0 0 0 1px rgba(0,0,0,.2);
  }

  .triple{display:grid; grid-template-columns: repeat(3,1fr); gap:10px;}
  .input, select{
    width:100%; padding:12px 12px; border-radius:12px;
    border:1px solid rgba(255,255,255,.08);
    background:var(--card); color:var(--text);
    outline:none; transition: .15s border, .15s box-shadow, .15s transform;
    font-size:15px;
  }
  select{ white-space:normal; word-break:break-word; }
  .input:focus, select:focus{ border-color:var(--brand); box-shadow:0 0 0 4px var(--ring); }

  .btn{
    display:inline-flex; align-items:center; justify-content:center; gap:8px;
    padding:12px 16px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
    background: linear-gradient(180deg, rgba(34,211,238,.22), rgba(34,211,238,.12));
    color:#052026; font-weight:600; letter-spacing:.3px; cursor:pointer;
    transition: .15s transform, .15s filter, .15s box-shadow; box-shadow:var(--shadow);
    touch-action:manipulation;
  }
  .btn:hover{filter:brightness(1.05)}
  .btn:active{transform:translateY(1px)}
  .btn-outline{background:transparent; color:var(--brand); border-color:rgba(34,211,238,.35)}
  .btn-row{display:flex; gap:10px; flex-wrap:wrap}

  /* è®“ã€Œç«‹å³æ–°å¢ã€æ›´é†’ç›® */
  #btnQuickAdd{
    background: radial-gradient(80% 120% at 50% -10%, rgba(167,139,250,.35), transparent 60%),
                linear-gradient(180deg, rgba(34,211,238,.35), rgba(34,211,238,.16));
    border-color: rgba(34,211,238,.55);
    box-shadow: 0 0 0 4px rgba(34,211,238,.18), 0 12px 26px rgba(0,0,0,.35);
    font-weight:800;
  }
  #btnQuickAdd:hover{ filter:brightness(1.08) }
  #btnQuickAdd:active{ transform: translateY(1px) }

  .hint{font-size:12px; color:var(--muted); margin-top:4px}

  /* å³å´æ¸…å–® */
  .list{display:grid; gap:12px;}
  .card{
    position:relative; display:grid; gap:6px;
    padding:14px 16px; border-radius:14px;
    background:linear-gradient(180deg, rgba(255,255,255,.03), transparent 50%), var(--card);
    border:1px solid rgba(255,255,255,.06);
  }
  .title{font-weight:600; letter-spacing:.3px}
  .row2{display:flex; align-items:center; justify-content:space-between; gap:10px}
  .count{font-variant-numeric:tabular-nums; font-size:18px; letter-spacing:.5px}
  .soon .count{ color:var(--warn)}
  .expired .count{ color:var(--danger)}
  .badge{
    font-size:12px; padding:2px 8px; border-radius:999px;
    background:rgba(167,139,250,.15); color:var(--accent);
    border:1px solid rgba(167,139,250,.35)
  }
  .tools{display:flex; gap:8px}
  .iconbtn{
    width:36px; height:36px; display:inline-grid; place-items:center; border-radius:10px;
    border:1px solid rgba(255,255,255,.08); background:transparent; color:var(--muted);
    cursor:pointer; touch-action:manipulation;
  }
  .iconbtn:hover{color:#fff; border-color:rgba(255,255,255,.24)}
  .empty{text-align:center; color:var(--muted); padding:24px 8px; border:1px dashed rgba(255,255,255,.12); border-radius:14px}

  /* Modalï¼ˆå®Œæ•´å¡«å–®ä»å¯ç”¨ï¼‰ */
  .modal{position:fixed; inset:0; display:none; place-items:center; z-index:50; background:rgba(3,7,18,.55); backdrop-filter: blur(2px);}
  .modal.open{display:grid}
  .sheet{width:min(680px, 92vw); background:var(--panel); border:1px solid rgba(255,255,255,.09); border-radius:18px; padding:18px; box-shadow:var(--shadow)}
  .sheet h2{margin:0 0 10px 0}
  .sheet .grid2{display:grid; gap:12px; grid-template-columns: 1fr 1fr}
  .sheet .footer{display:flex; justify-content:flex-end; gap:10px; margin-top:6px}
  .req::after{content:"*"; color:var(--danger); margin-left:2px}
  .small{font-size:12px; color:var(--muted)}

  /* RWD */
  @media (max-width:980px){ .grid{grid-template-columns:1fr} }
  @media (max-width:640px){
    .wrap{padding:0 14px}
    .panel{padding:14px; border-radius:16px}
    .row{grid-template-columns:1fr; gap:8px}
    /* è¡Œå‹•ï¼šä¸‰æ¬„è‡ªå‹•æ”¹ç‚ºç›´æ’ */
    .row3{grid-template-columns:1fr}
    .triple{grid-template-columns:repeat(3,minmax(0,1fr)); gap:8px}
    .btn{width:100%}
    .btn-row{flex-direction:column}
    .iconbtn{width:40px; height:40px}
    .count{font-size:20px}
    .sheet{width:100vw; max-width:100vw; border-radius:16px 16px 0 0; padding:16px; align-self:end}
    .sheet .grid2{grid-template-columns:1fr}
  }

  /* é¡Œé ­å³ä¸Šçš„ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• */
.tbtn{
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  padding:8px 12px; border-radius:999px; cursor:pointer;
  border:1px solid rgba(255,255,255,.18);
  background:linear-gradient(180deg, rgba(34,211,238,.25), rgba(34,211,238,.12));
  color:#052026; font-weight:700; letter-spacing:.2px;
  box-shadow:0 6px 18px rgba(0,0,0,.25);
}
body.light .tbtn{
  border-color:rgba(0,0,0,.08);
  background:linear-gradient(180deg, rgba(2,132,199,.18), rgba(2,132,199,.08));
  color:#0f172a; box-shadow:0 6px 18px rgba(2,132,199,.15);
}

/* â€”â€” æ·ºè‰²ä¸»é¡Œï¼šè¦†å¯«è®Šæ•¸ â€”â€” */
body.light{
  --bg:#f5f7fb;          /* æ·ºåº• */
  --panel:#ffffff;       /* ä¸»è¦é¢æ¿ */
  --card:#ffffff;        /* å¡ç‰‡ */
  --text:#0f172a;        /* æ·±å­— */
  --muted:#475569;       /* æ¬¡è¦å­— */
  --ring:rgba(2,132,199,.25);
  --shadow:0 10px 30px rgba(15,23,42,.08);
}
/* è®“ header èƒŒæ™¯åœ¨æ·ºè‰²æ™‚æ›´ä¹¾æ·¨ */
body.light header{
  background:linear-gradient(180deg, rgba(255,255,255,.86), rgba(255,255,255,0));
  backdrop-filter:saturate(120%) blur(4px);
}
/* å¡ç‰‡é‚Šæ¡†åœ¨æ·ºè‰²æ™‚æ›´æ·¡ä¸€é» */
body.light .panel,
body.light .card{ border-color: rgba(15,23,42,.08); }
/* ç©ºæ¸…å–®æç¤ºçš„è™›ç·šæ¡†åœ¨æ·ºè‰²æ™‚ */
body.light .empty{ border-color: rgba(15,23,42,.12); color:#64748b; }
/* é€šç”¨ï¼šæŠŠç€è¦½å™¨é è¨­æŒ‰éˆ•å¤–è§€é—œæ‰ */
button {
  font: inherit;
}
.iconbtn{
  -webkit-appearance: none;
  appearance: none;
  background: transparent;
  outline: none;
  line-height: 1;
}

/* è† å›Šå°æŒ‰éˆ•ï¼ˆé‡ç½®/å»¶å¾Œç”¨ï¼‰ */
.iconbtn.chip{
  min-width: 40px;
  height: 32px;
  padding: 0 10px;
  border-radius: 999px;
  border: 1px solid rgba(34,211,238,.35);
  background: linear-gradient(180deg, rgba(34,211,238,.22), rgba(34,211,238,.12));
  color: #052026;
  font-weight: 700;
  box-shadow: 0 1px 0 rgba(0,0,0,.06);
}
.iconbtn.chip:hover{ filter: brightness(1.05); }
/* ç™½æ¨£å¼ä¸‹ï¼Œhover ä¿æŒæ·±è‰²å­—é«” */
body.light .btn:hover { 
  color:#000;    /* æˆ– #0f172aï¼Œæ¯”è¼ƒæŸ”å’Œçš„é»‘ */
}

body.light .iconbtn:hover {
  color:#000;    /* ä¿æŒå¯è¦‹ */
  border-color:rgba(0,0,0,.24);
}
.iconbtn.chip:active{ transform: translateY(1px); }
.iconbtn.chip:focus-visible{ box-shadow: 0 0 0 3px rgba(34,211,238,.25); }

/* ç™½æ¨£å¼ä¸‹çš„å°æ¯” */
body.light .iconbtn.chip{
  border-color: rgba(2,132,199,.30);
  background: linear-gradient(180deg, rgba(2,132,199,.18), rgba(2,132,199,.08));
  color: #0f172a;
}

/* åˆªé™¤ç¶­æŒæ·¡æ·¡ç°è‰²ï¼ˆä½†ä¹Ÿé—œé–‰é è¨­å¤–è§€ï¼‰ */
.iconbtn.danger{
  -webkit-appearance: none; appearance: none;
  width: 36px; height: 32px; padding: 0;
  border-radius: 8px;
  border: 1px solid rgba(0,0,0,.10);
  background: transparent; color: #64748b;
}
body:not(.light) .iconbtn.danger{ border-color: rgba(255,255,255,.14); color: var(--muted); }
.iconbtn.danger:hover{ filter: brightness(1.1); }

</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>æ•‘ä¸–è€…ä¹‹æ¨¹ m - é‡ç‹è¨ˆæ™‚å™¨</h1>
      <div style="display:flex; align-items:center; gap:10px;">
        <button id="themeToggle" class="tbtn" type="button" aria-pressed="false" title="åˆ‡æ›ä¸»é¡Œ">â˜€ï¸ æ—¥é–“</button>
        <div class="now" id="now">â€”</div>
      </div>
    </header>
    <div class="grid">
      <!-- å·¦é‚Šï¼šæ“ä½œ/èªªæ˜ -->
      <section class="panel">
        <div class="meta">

          <div class="kv">
            <label>å¿«é€Ÿæ–°å¢</label>
            <!-- ä¸‰æ¬„ï¼šA / B / åˆ†æµ+é¡è‰² -->
            <div class="row row3">
              <select id="quickA" class="input" title="ä¸»åˆ†é¡ (A)"></select>
              <select id="quickB" class="input" title="æ¬¡åˆ†é¡ (B)"></select>
              <div class="laneWrap">
                <input id="lane" class="input" type="number" min="1" value="1" title="åˆ†æµ">
                <span id="laneSwatch" class="swatch" title="æ­¤æ¬¡åˆ†æµé¡è‰²"></span>
              </div>
            </div>
          </div>

          <div class="kv">
            <label>é è¨­é‡ç”Ÿæ™‚é–“ (å°æ™‚/åˆ†/ç§’)</label>
            <div class="triple">
              <input id="dH" class="input" type="number" min="0" value="0" />
              <input id="dM" class="input" type="number" min="0" value="5" />
              <input id="dS" class="input" type="number" min="0" value="0" />
            </div>
            <div class="hint">æ­¤å€åªå½±éŸ¿ã€Œå¿«é€Ÿæ–°å¢ã€ï¼ŒçœŸæ­£çš„å€’æ•¸ä»¥æ¯å€‹é …ç›®å»ºç«‹æ™‚çš„è¨­å®šç‚ºæº–ã€‚</div>
          </div>

          <div class="row">
            <!-- å·²æŠŠåˆ†æµç§»ä¸Šå»ï¼Œé€™è£¡åªç•™æé†’åˆ† -->
            <div class="kv" style="grid-column:1/-1">
              <label>æé†’æ™‚é–“ (åˆ†)</label>
              <input id="leadMin" class="input" type="number" min="0" value="0" />
            </div>
          </div>

          <div class="kv">
            <div class="btn-row">
              <button id="btnQuickAdd" class="btn" type="button">â• ç«‹å³æ–°å¢</button>
              <button id="btnOpenForm" class="btn btn-outline" type="button">ğŸ“ è©³ç´°è¨­å®š</button>
            </div>
            <div class="hint">ç›´æ¥ç”¨ä¸Šæ–¹çš„å¿«é€Ÿæ¬„ä½æŒ‰ã€Œç«‹å³æ–°å¢ã€ï¼›è‹¥è¦å¾®èª¿ä¸åŒæ•¸å€¼ï¼Œå¯é»ã€Œè©³ç´°è¨­å®šã€ã€‚</div>
          </div>

          <div class="kv">
            <button id="btnClear" class="btn btn-outline" type="button">ğŸ§¹ æ¸…ç©ºæ‰€æœ‰è¨ˆæ™‚</button>
            <div class="hint">æ‰€æœ‰è³‡æ–™æœƒå­˜å…¥ Cookieï¼ˆä¿å­˜ 1 å¹´ï¼‰ã€‚</div>
          </div>
        </div>
      </section>

      <!-- å³é‚Šï¼šæ¸…å–® -->
      <section class="panel">
        <div id="list" class="list"></div>
        <div id="empty" class="empty" style="display:none">ç›®å‰æ²’æœ‰è¨ˆæ™‚ï¼Œé»å·¦é‚Šã€Œç«‹å³æ–°å¢ã€é–‹å§‹å§ï¼</div>
      </section>
    </div>
  </div>

  <!-- Modal è¡¨å–®ï¼ˆå¯é¸ï¼‰ -->
  <div class="modal" id="modal">
    <div class="sheet">
      <h2>æ–°å¢è¨ˆæ™‚ï¼ˆè©³ç´°è¨­å®šï¼‰</h2>
      <div class="grid2">
        <div class="kv">
          <label class="req">ä¸»åˆ†é¡ A</label>
          <select id="formA" class="input"></select>
        </div>
        <div class="kv">
          <label class="req">æ¬¡åˆ†é¡ B</label>
          <select id="formB" class="input"></select>
        </div>

        <div class="kv">
          <label class="req">é‡ç”Ÿæ™‚é–“ï¼ˆæ™‚ / åˆ† / ç§’ï¼‰</label>
          <div class="triple">
            <input id="formH" class="input" type="number" min="0" value="0">
            <input id="formM" class="input" type="number" min="0" value="5">
            <input id="formS" class="input" type="number" min="0" value="0">
          </div>
          <div class="small">å»ºç«‹å¾Œå³é–‹å§‹å€’æ•¸ã€‚</div>
        </div>

        <div class="kv">
          <label>åˆ†æµ</label>
          <input id="formLane" class="input" type="number" min="1" value="1">
        </div>

        <div class="kv">
          <label>æé†’æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
          <input id="formLead" class="input" type="number" min="0" value="0">
        </div>
      </div>
      <div class="footer">
        <button id="btnCancel" class="btn btn-outline" type="button">å–æ¶ˆ</button>
        <button id="btnAdd" class="btn" type="button">æ–°å¢è¨ˆæ™‚</button>
      </div>
    </div>
  </div>

  <!-- ä½¿ç”¨å¤–éƒ¨ mp3 éŸ³æ•ˆ -->
  <audio id="beep" preload="auto">
    <source src="https://www.pacdv.com/sounds/interface_sound_effects/sound28.mp3" type="audio/mp3">
  </audio>
<div id="counter"></div>
<script>
/* ===== ä¸»é¡Œåˆ‡æ›ï¼šæ·±/æ·ºè‰² ===== */
const THEME_KEY = 'theme';
function applyTheme(theme){
  if(theme === 'light'){ document.body.classList.add('light'); }
  else{ document.body.classList.remove('light'); theme = 'dark'; }
  localStorage.setItem(THEME_KEY, theme);
  updateThemeToggleUI();
}
function updateThemeToggleUI(){
  const btn = document.getElementById('themeToggle');
  if(!btn) return;
  const isLight = document.body.classList.contains('light');
  btn.textContent = isLight ? 'ğŸŒ™ å¤œé–“' : 'â˜€ï¸ æ—¥é–“';
  btn.setAttribute('aria-pressed', String(isLight));
  btn.title = isLight ? 'åˆ‡æ›åˆ°æ·±è‰²æ¨¡å¼' : 'åˆ‡æ›åˆ°æ·ºè‰²æ¨¡å¼';
}
// åˆå§‹ï¼šæ‹¿ä½¿ç”¨è€…è¨­å®šï¼Œå¦å‰‡è·Ÿéš¨ç³»çµ±
(function initTheme(){
  const saved = localStorage.getItem(THEME_KEY);
  const sysLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
  applyTheme(saved || (sysLight ? 'light' : 'dark'));
  // æŒ‰éˆ•äº‹ä»¶
  document.addEventListener('click', (e)=>{
    if(e.target && e.target.id === 'themeToggle'){
      const isLight = document.body.classList.contains('light');
      applyTheme(isLight ? 'dark' : 'light');
    }
  });
})();

/* -------------------- å°å·¥å…·ï¼šCookie -------------------- */
const COOKIE_KEY = "bossTimers_v1";
const COOKIE_FORM = "bossForm_v1";
function setCookie(name, value, days=365){
  const expires = new Date(Date.now()+days*864e5).toUTCString();
  document.cookie = `${encodeURIComponent(name)}=${encodeURIComponent(value)}; expires=${expires}; path=/; samesite=lax`;
}
function getCookie(name){
  const m = document.cookie.match(new RegExp('(?:^|; )'+encodeURIComponent(name)+'=([^;]*)'));
  return m ? decodeURIComponent(m[1]) : "";
}

/* -------------------- è³‡æ–™æ¨¡å‹ -------------------- */
let timers = []; // {id, a, b, lane, laneColor, durationMs, leadMin, startAt, alert1Fired, alert2Fired}
const $ = s => document.querySelector(s);
const listEl = $('#list');
const emptyEl = $('#empty');
const beepEl = $('#beep');

/* -------------------- ä¸»/æ¬¡é¸å–®è³‡æ–™ -------------------- */
const B_DICT = {
  "Episode 1": [
    "å¤å¥§é›·ä¼Šè¥¿é‚Šæ£®æ— Lv.1 - å‘åŠ£çš„ èµ¤ç´…å¸ƒè²é–€å£«",
    "å¤å¥§é›·ä¼Šæ±é‚Šæ£®æ— Lv.3 - å¼·éŸŒçš„ æƒ¡éˆå›ä¸»",
    "è“®å¸•æ‹‰æ²™æ± å¡˜ Lv.5 - ä¸ç¥¥çš„ æ¬¡å…ƒè£‚ç¸«"
  ],
  "Episode 2": [
    "æ–¯æ‹‰å±‹å¡”æ–¯å³½è°· Lv.10 - å‘åŠ£çš„ ç¨çœ¼å·¨äºº",
    "å‡±åˆ©é«˜åŸ Lv.11 - å¼·éŸŒçš„ ç‘ªçˆ¾é›·é£›é¾",
    "å¥ˆæ™®é‡Œå¡”æ–¯æ‡¸å´– Lv.12 - å¼·éŸŒçš„ åœ°ç„äº¡éˆ",
    "æ³°å…§èŠ±åœ’ Lv.13 - å¼·éŸŒçš„ ç‹åº§å¤§èœ˜è››",
    "æ³°å…§è–å ‚åœ°ä¸‹1å±¤ Lv.15 - å¼·éŸŒçš„ è±¬ç± è‰"
  ],
  "Episode 3": [
    "åº«é­¯æ£®æ— Lv.20 - å‘åŠ£çš„ æœ¨ä¹ƒä¼Šè³½è¥¿ç‰¹",
    "å…‹å°¼å¤šæ–¯æ£®æ— Lv.21 - å¼·éŸŒçš„ ä¼Šå ¤æ–¯å¤§å˜´ç¸",
    "é”å·´æ£®æ— Lv.22 - å¼·éŸŒçš„ ç¶­å°¼äºçŒ´å­",
    "è«¾å·´å“ˆå…¬æœƒæ‰€ Lv.24 - ä¸ç¥¥çš„ æ¬¡å…ƒè£‚ç¸«",
    "è«¾å·´å“ˆæœ¬é™¢ Lv.28 - æ†¤æ€’çš„ æ­»äº¡é­”å¥³"
  ],
  "Episode 4": [
    "è²é›…å±±è°· Lv.30 - å‘åŠ£çš„ å¥³å¦–å…‹èŠé»˜",
    "æ¯”çˆ¾å¡”æºªè°· Lv.31 - ä¸ç¥¥çš„ æ¬¡å…ƒè£‚ç¸«",
    "ç§‘åšçˆ¾ç‰¹æ£®æ— Lv.32 - å¼·éŸŒçš„ é­”æ–¯æ€ª",
    "åŸ¹çˆ¾å…‹ç¥æ®¿ Lv.36 - å¼·éŸŒçš„ æ¯’é­”è›™",
    "å®‰æ£®å¡”å†°æºåœ° Lv.38 - æ†¤æ€’çš„ æ°´è›­"
  ],
  "Episode 5": [
    "èŠå¡”æ–¯å°æºª Lv.42 - ä¸ç¥¥çš„ æ¬¡å…ƒè£‚ç¸«",
    "å¾·æ…•çˆ¾ä½ƒè¾²æ‘ Lv.44 - å‘åŠ£çš„ åœ°å¿ƒè •ç‹",
    "å¾·æ…•çˆ¾èŠåœ’ Lv.46 - å¼·éŸŒçš„ å…‹èŠæ“”æ€ª",
    "å¾·æ…•çˆ¾å¤–åŸ Lv.48 - æ†¤æ€’çš„ èµ¤ç´…é›·ç­æ‰ç‰¹"
  ],
  "Episode 6": [
    "é”ä¼Šç´é¤Šèœ‚åœ° Lv.50 - å‘åŠ£çš„ å­Ÿæè‚¯",
    "æ¯”çˆ¾é‚£æ£®æ— Lv.51 - å¼·éŸŒçš„ å¡”å¥§ç‘ªæ–¯",
    "çƒå¥‡æ–¯è€•è€˜ä½œåœ° Lv.52 - ä¸ç¥¥çš„ æ¬¡å…ƒè£‚ç¸«",
    "æ˜¥å…‰æ¨¹æ— Lv.53 - æ†¤æ€’çš„ ä½›è˜­æ™®",
    "é—œå£è·¯ Lv.55 - å¼·éŸŒçš„ åˆ‡æ³¢å‹’",
    "å²çˆ¾ç‰¹å‡±æ‹‰æ£®æ— Lv.57 - å¼·éŸŒçš„ äºé­¯"
  ],
  "Episode 7": [
    "é­¯å¡æ–¯é«˜åŸ Lv.60 - å‘åŠ£çš„ è²äºå¡æ‹‰æ–¯",
    "ç‹ä¹‹é«˜åŸ Lv.61 - å¼·éŸŒçš„ å¡šä¸»æ´›å¾·",
    "æœ­å¡é‡Œè€¶è€¶çˆ¾äº¤å‰è·¯ Lv.62 - ä¸ç¥¥çš„ æ¬¡å…ƒè£‚ç¸«",
    "ç‹é™µ1å±¤ Lv.64 - å¼·éŸŒçš„ åº«å‹’å¡æ–¯",
    "ç‹é™µ2å±¤ Lv.66 - æ†¤æ€’çš„ é›·å…‹è¥¿æ³¢",
    "ç‹é™µ3å±¤ Lv.68"
  ],
  "Episode 8": [
    "é˜¿é›·é­¯è«¾ç”·çˆµé ˜ Lv.70 - å‘åŠ£çš„ å·¨é­”èŸ»",
    "æ°´è·¯æ©‹åœ°å€ Lv.70 - å¼·éŸŒçš„ å…‹æ´›æå¾·",
    "é­”æ—æ”¶ç›£æ‰€ç¬¬1å€ Lv.71 - å¼·éŸŒçš„ å¸ƒçˆ¾é­¯",
    "é­”æ—æ”¶ç›£æ‰€ç¬¬3å€ Lv.72 - å‘åŠ£çš„ åŠªäºè€¶é›·",
    "é­”æ—æ”¶ç›£æ‰€ç¬¬4å€ Lv.73 - å¼·éŸŒçš„ è¿ªæ­å°¼æ–¯",
    "é­”æ—æ”¶ç›£æ‰€ç¬¬5å€ Lv.74 - æ†¤æ€’çš„ å“ˆå‹’å…‹"
  ],
  "Episode 9": [
    "å¥³ç¥çš„å¤é™¢ Lv.75 - å¼·éŸŒçš„ æ­»éˆæŸ¥æ™®åˆ©",
    "ä½©è¿ªç±³å®‰å¤–åŸ Lv.76 - å‘åŠ£çš„ æƒ¡é­”è‘›æ´›å¤«",
    "é­”æ³•å¸«ä¹‹å¡”1å±¤ Lv.77 - å¼·éŸŒçš„ ç«ç„°èœ˜è››ç‹",
    "é­”æ³•å¸«ä¹‹å¡”2å±¤ Lv.78 - å¼·éŸŒçš„ ç‘ªå› æ´›å¾·",
    "é­”æ³•å¸«ä¹‹å¡”3å±¤ Lv.79 - æ†¤æ€’çš„ æ—å˜‰å¡éœ²å¥³å¦–"
  ],
  "Episode 10": [
    "å¤§æ•™å ‚æ‡ºæ‚”è·¯ Lv.80 - å‘åŠ£çš„ å˜æ‹‰åº«æ›¼",
    "å¤§æ•™å ‚æ­£æ®¿ Lv.81 - å¼·éŸŒçš„ ç«ç„°æ¬Šæ–",
    "å¤§æ•™å ‚å¤§è¿´å»Š Lv.82 - å¼·éŸŒçš„ åˆ©æ³°åŠ›æ–¯",
    "å¤§æ•™å ‚è‡³è–æ‰€ Lv.83 - æ†¤æ€’çš„ é‚£æŸ¯ææ–¯"
  ]
};
const A_OPTIONS = Object.keys(B_DICT);

/* -------------------- éš¨æ©Ÿè‰²èˆ‡å°æ¯”è‰² -------------------- */
const COLOR_POOL = ['#22d3ee','#a78bfa','#34d399','#f59e0b','#ef4444','#60a5fa','#f472b6','#84cc16','#eab308','#fb7185'];
function randomColor(){ return COLOR_POOL[Math.floor(Math.random()*COLOR_POOL.length)]; }
function textColorFor(hex){
  // ç°¡æ˜“ YIQ å°æ¯”ï¼š> 150 ç”¨æ·±å­—ï¼Œå¦å‰‡ç™½å­—
  const c = hex.replace('#','');
  const r = parseInt(c.substring(0,2),16);
  const g = parseInt(c.substring(2,4),16);
  const b = parseInt(c.substring(4,6),16);
  const yiq = (r*299 + g*587 + b*114)/1000;
  return yiq >= 150 ? '#0b1220' : '#ffffff';
}

/* -------------------- åˆå§‹åŒ–é¸å–® -------------------- */
function fillA(sel){
  sel.innerHTML = A_OPTIONS.map(v=>`<option value="${v}">${v}</option>`).join('');
}
function fillB(sel, aValue){
  const arr = B_DICT[aValue] || [];
  sel.innerHTML = arr.map(v=>`<option value="${v}">${v}</option>`).join('');
}

/* -------------------- å„²å­˜ / è¼‰å…¥ -------------------- */
function save(){ setCookie(COOKIE_KEY, JSON.stringify(timers)); }
function load(){
  const raw = getCookie(COOKIE_KEY);
  timers = raw ? JSON.parse(raw) : [];
}

function saveFormState(){
  const state = {
    quickA: $('#quickA').value,
    quickB: $('#quickB').value,
    dH: +$('#dH').value||0,
    dM: +$('#dM').value||0,
    dS: +$('#dS').value||0,
    lane: +$('#lane').value||1,
    leadMin: +$('#leadMin').value||0
  };
  setCookie(COOKIE_FORM, JSON.stringify(state));
}
function loadFormState(){
  const raw = getCookie(COOKIE_FORM);
  if(!raw) return;
  try{
    const s = JSON.parse(raw);
    if(s.quickA){ $('#quickA').value = s.quickA; fillB($('#quickB'), s.quickA); }
    if(s.quickB){ $('#quickB').value = s.quickB; }
    ['dH','dM','dS','lane','leadMin'].forEach(k=>{
      if(s[k]!==undefined) $('#'+k).value = s[k];
    });
  }catch{}
}

/* -------------------- æ¸²æŸ“ -------------------- */
function fmt(ms){
  if(ms<0) ms=0;
  const t = Math.floor(ms/1000);
  const h = Math.floor(t/3600).toString().padStart(2,'0');
  const m = Math.floor((t%3600)/60).toString().padStart(2,'0');
  const s = (t%60).toString().padStart(2,'0');
  return `${h}:${m}:${s}`;
}
function fmtClock(ts){
  const d = new Date(ts);
  const hh = String(d.getHours()).padStart(2,'0');
  const mm = String(d.getMinutes()).padStart(2,'0');
  return `${hh}:${mm}`;
}
function render(){
  const now = Date.now();
  const sorted = [...timers].sort((x,y)=>{
    const rx = x.startAt + x.durationMs - now;
    const ry = y.startAt + y.durationMs - now;
    const ax = Math.max(rx, -1);
    const ay = Math.max(ry, -1);
    return ax - ay;
  });

  listEl.innerHTML = '';
  if(sorted.length===0){ emptyEl.style.display='block'; return; }
  emptyEl.style.display='none';

  sorted.forEach(t=>{
    const remain = t.startAt + t.durationMs - now;
    const soon = remain <= t.leadMin*60*1000 && remain>0;
    const expired = remain<=0;

    const card = document.createElement('div');
    card.className = 'card' + (soon?' soon':'') + (expired?' expired':'');
    const endAt = t.startAt + t.durationMs;

    // åˆ†æµè‰²æ¨£å¼
    const color = t.laneColor || '#a78bfa';
    const badgeBg = color;
    const badgeText = textColorFor(color);
    const borderCol = color;

    card.innerHTML = `
      <div class="row2">
        <div class="title">
          ${t.a} - ${t.b}
          <span class="badge" style="
            background:${badgeBg};
            color:${badgeText};
            border-color:${borderCol};
          ">åˆ†æµ ${t.lane}</span>
        </div>
        <div class="tools">
          <button class="iconbtn" title="é‡ç½®ï¼ˆåŒè¨­å®šï¼‰" data-act="reset" data-id="${t.id}">ğŸ”</button>
          <button class="iconbtn" title="å»¶å¾Œ 1 åˆ†é˜" data-act="plus1" data-id="${t.id}">+1</button>
          <button class="iconbtn" title="å»¶å¾Œ 5 åˆ†é˜" data-act="plus5" data-id="${t.id}">+5</button>
          <button class="iconbtn" title="åˆªé™¤" data-del="${t.id}">ğŸ—‘ï¸</button>
        </div>
      </div>
      <div class="row2">
        <div class="count">${fmt(remain)}</div>
        <div class="small">æé†’ï¼š${t.leadMin} åˆ†ï½œåˆ°é»ï¼š<b>${fmtClock(endAt)}</b></div>
      </div>
    `;
    listEl.appendChild(card);
  });
}

/* -------------------- è¨ˆæ™‚å¾ªç’° / æé†’ -------------------- */
function tick(){
  const now = Date.now();
  timers.forEach(t=>{
    const alertAt = t.startAt + t.durationMs - t.leadMin*60*1000;
    if(!t.alert1Fired && t.leadMin>0 && now >= alertAt && now < t.startAt + t.durationMs){
      t.alert1Fired = true; try{ beep.currentTime=0; beep.play(); }catch{}
    }
    if(!t.alert2Fired && now >= t.startAt + t.durationMs){
      t.alert2Fired = true; try{ beep.currentTime=0; beep.play(); }catch{}
    }
  });
  render();
}
setInterval(()=>{ $('#now').textContent = new Date().toLocaleString(); tick(); }, 1000);

/* -------------------- å»ºç«‹ / åˆªé™¤ -------------------- */
function addTimer(data){
  const id = crypto.randomUUID ? crypto.randomUUID() : String(Date.now()+Math.random());
  timers.push({
    id,
    a: data.a,
    b: data.b,
    lane: +data.lane||1,
    laneColor: data.color || randomColor(),
    durationMs: ((+data.h||0)*3600 + (+data.m||0)*60 + (+data.s||0)) * 1000,
    leadMin: +data.lead||0,
    startAt: Date.now(),
    alert1Fired:false,
    alert2Fired:false
  });
  save(); render();
}
function deleteTimer(id){
  timers = timers.filter(t=>t.id!==id);
  save(); render();
}
listEl.addEventListener('click', (e)=>{
  const delId = e.target?.dataset?.del;
  if (delId) { deleteTimer(delId); return; }

  const act = e.target?.dataset?.act;
  const id  = e.target?.dataset?.id;
  if (!act || !id) return;

  const t = timers.find(x=>x.id===id);
  if (!t) return;

  const now = Date.now();
  if (act === 'reset') {
    t.startAt = now; t.alert1Fired = false; t.alert2Fired = false;
  } else if (act === 'plus1') {
    t.startAt += 60 * 1000; t.alert2Fired = false;
  } else if (act === 'plus5') {
    t.startAt += 5 * 60 * 1000; t.alert2Fired = false;
  }
  save(); render();
});

/* -------------------- å¿«é€Ÿæ–°å¢ï¼ˆä¸å½ˆçª—ï¼Œç„¡ç¢ºèªï¼‰ -------------------- */
let currentLaneColor = randomColor();
const laneSwatch = document.getElementById('laneSwatch');
function updateLaneSwatch(){ laneSwatch.style.background = currentLaneColor; laneSwatch.title = `æ­¤æ¬¡åˆ†æµé¡è‰²ï¼š${currentLaneColor}`; }
function quickAdd(){
  const data = {
    a: $('#quickA').value,
    b: $('#quickB').value,
    h: +$('#dH').value||0,
    m: +$('#dM').value||0,
    s: +$('#dS').value||0,
    lane: +$('#lane').value||1,
    lead: +$('#leadMin').value||0,
    color: currentLaneColor
  };
  if((data.h+data.m+data.s)===0){ alert('é‡ç”Ÿæ™‚é–“ä¸å¯ç‚º 0'); return; }
  addTimer(data);
  saveFormState();
  // ä¸‹ä¸€æ¬¡æ–°å¢æ›ä¸€å€‹é¡è‰²
  currentLaneColor = randomColor();
  updateLaneSwatch();
}

/* -------------------- è¡¨å–®ï¼ˆå¯é¸ï¼‰ -------------------- */
const modal = $('#modal');
const openModal = ()=>{ modal.classList.add('open'); syncFormFromQuick(); };
const closeModal = ()=>{ modal.classList.remove('open'); };

$('#btnOpenForm').addEventListener('click', ()=>{ openModal(); try{beep.play().catch(()=>{});}catch{} });
$('#btnCancel').addEventListener('click', closeModal);

function syncFormFromQuick(){
  $('#formA').value = $('#quickA').value;
  fillB($('#formB'), $('#formA').value);
  $('#formB').value = $('#quickB').value;

  $('#formH').value = +$('#dH').value||0;
  $('#formM').value = +$('#dM').value||0;
  $('#formS').value = +$('#dS').value||0;
  $('#formLane').value = +$('#lane').value||1;
  $('#formLead').value = +$('#leadMin').value||0;
}
$('#btnAdd').addEventListener('click', ()=>{
  const data = {
    a: $('#formA').value,
    b: $('#formB').value,
    h: +$('#formH').value||0,
    m: +$('#formM').value||0,
    s: +$('#formS').value||0,
    lane: +$('#formLane').value||1,
    lead: +$('#formLead').value||0,
    color: randomColor() // è¡¨å–®æ–°å¢ä¹Ÿçµ¦éš¨æ©Ÿé¡è‰²
  };
  if((data.h+data.m+data.s)===0){ alert('é‡ç”Ÿæ™‚é–“ä¸å¯ç‚º 0'); return; }
  addTimer(data);
  // åŒæ­¥å›å¿«é€Ÿå€
  $('#quickA').value = data.a; fillB($('#quickB'), data.a); $('#quickB').value = data.b;
  $('#dH').value=data.h; $('#dM').value=data.m; $('#dS').value=data.s;
  $('#lane').value=data.lane; $('#leadMin').value=data.lead;
  saveFormState();
  closeModal();
});

/* A è®Šå‹• â†’ B é‡å»ºï¼ˆå¿«é€Ÿå€èˆ‡è¡¨å–®å€ï¼‰ */
function hookCascade(aSel, bSel){
  aSel.addEventListener('change', ()=>{
    fillB(bSel, aSel.value);
    saveFormState();
  });
}
hookCascade($('#quickA'), $('#quickB'));
hookCascade($('#formA'),  $('#formB'));

/* å¿«é€Ÿå€æŒ‰éˆ• */
document.getElementById('btnQuickAdd').addEventListener('click', quickAdd);

/* å¿«é€Ÿæ¬„ä½æ›´å‹• â†’ å­˜ Cookie */
['#quickA','#quickB','#dH','#dM','#dS','#lane','#leadMin'].forEach(s=>{
  $(s).addEventListener('change', saveFormState);
  $(s).addEventListener('input', saveFormState);
});

/* æ¸…ç©º */
$('#btnClear').addEventListener('click', ()=>{
  if(confirm('ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰è¨ˆæ™‚ï¼Ÿ')){ timers = []; save(); render(); }
});

/* -------------------- å•Ÿå‹• -------------------- */
function boot(){
  fillA($('#quickA')); fillB($('#quickB'), A_OPTIONS[0]);
  fillA($('#formA'));  fillB($('#formB'), A_OPTIONS[0]);

  ['quickA','quickB','formA','formB'].forEach(id=>{
    const el = document.getElementById(id);
    el && el.addEventListener('change', ()=>{ el.blur && el.blur(); });
  });

  updateLaneSwatch(); // é¡¯ç¤ºç¬¬ä¸€æ¬¡çš„åˆ†æµé¡è‰²
  loadFormState(); load(); render();
}
boot();
</script>
</body>
<footer style="margin:40px auto; padding:20px; text-align:center; font-size:13px; color:var(--muted)">
  <div style="margin-bottom:8px">
    è¨ªå®¢è¨ˆæ•¸å™¨ï¼š
    <a href="https://cn.web-counter.net" title="ç¶²ç«™è¨ªå•è¨ˆæ•¸">
      <img src="https://www.web-counter.net/count_20091204.php?c=1fuYlQ1R9xV" 
            style="border:0;padding:0;margin:0;" 
            alt="ç¶²ç«™è¨ªå•è¨ˆæ•¸" />
    </a>
  </div>
  <div>
    æœ¬å·¥å…·ç”± <a href="https://could562073.github.io" target="_blank" rel="noopener">Jun Rong Chen</a> è£½ä½œã€‚
  </div>
  <div>
    æœ¬è¨ˆæ™‚å™¨ç‚ºç©å®¶è‡ªè£½ä¹‹éå®˜æ–¹å·¥å…·ï¼Œåƒ…ä¾›å€‹äººå¨›æ¨‚ä½¿ç”¨ï¼Œè«‹å‹¿ç”¨æ–¼å•†æ¥­ç”¨é€”ã€‚
  </div>
</footer>

</html>
